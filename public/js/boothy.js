// Generated by CoffeeScript 1.3.3

window.dataURItoBlob = function(dataURI, callback) {
  var ab, bb, byteString, i, ia, mimeString;
  byteString = atob(dataURI.split(",")[1]);
  mimeString = dataURI.split(",")[0].split(":")[1].split(";")[0];
  ab = new ArrayBuffer(byteString.length);
  ia = new Uint8Array(ab);
  i = 0;
  while (i < byteString.length) {
    ia[i] = byteString.charCodeAt(i);
    i++;
  }
  bb = new Blob([ab], {
    type: mimeString
  });
  return bb;
};

$(function() {
  var sayCheese;
  sayCheese = new SayCheese("#say-cheese-container");
  sayCheese.on("start", function() {
    $("#action-buttons").fadeIn("fast");
    return $("#take-snapshot").on("click", function(evt) {
      return sayCheese.takeSnapshot();
    });
  });
  sayCheese.on("error", function(error) {
    var $alert;
    $alert = $("<div>");
    $alert.addClass("alert alert-error").css("margin-top", "20px");
    if (error === "NOT_SUPPORTED") {
      $alert.html("<strong>:(</strong> your browser doesn't support this yet!");
    } else {
      $alert.html("<strong>:(</strong> you have to click 'allow' to try me out!");
    }
    return $(".say-cheese").prepend($alert);
  });
  sayCheese.on("snapshot", function(snapshot) {
    var data_uri, img;
    img = document.createElement("img");
    $(img).on("load", function() {
      return $("#say-cheese-snapshots").prepend(img);
    });
    console.log(snapshot);
    data_uri = snapshot.toDataURL("image/png");
    window.blob_test = window.dataURItoBlob(data_uri);
    console.log(window.blob_test);
    return img.src = data_uri;
  });
  return sayCheese.start();
});
